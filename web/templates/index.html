<!-- web/templates/index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Classroom Air Distribution</title>
  <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
  <header>
    <h1>Classroom Air Distribution</h1>
    <p>Enter room and system info, then click Predict. (You can optionally specify diffuser/return coordinates.)</p>

    <p class="intro-text" style="margin-top:0.5rem">
  <strong>What is ADPI?</strong>
  Air Diffusion Performance Index is the <em>percentage of occupied zone points</em> that
  pass a comfort test combining local temperature and air speed.
  We compute a local Effective Draft Temperature (EDT) and air speed at each grid point and score it
  against comfort limits.
</p>

<div class="intro-panel" style="font-size:0.95rem; line-height:1.35; background:#0f172a0d; border:1px solid #e2e8f0; border-radius:8px; padding:10px 12px;">
  <div><strong>Equations (SI):</strong></div>
  <div style="margin:6px 0">
    <code>EDT(x,y) = (T<sub>x</sub> − T<sub>r</sub>) − 8 · (V<sub>x</sub> − 0.15)</code>
  </div>
  <div style="margin:6px 0">
    <code>ADPI = (# points with EDT<sub>min</sub> ≤ EDT ≤ EDT<sub>max</sub> and V<sub>x</sub> &lt; V<sub>max</sub>) / (# all points) × 100%</code>
  </div>
  <div style="margin-top:6px">
    Typical cooling thresholds: <code>EDT<sub>min</sub> ≈ −1.7 °C</code>,
    <code>EDT<sub>max</sub> ≈ +1.1 °C</code>, <code>V<sub>max</sub> ≈ 0.35 m/s</code>.
  </div>
  <div style="margin-top:6px">
    <strong>Interpretation:</strong> Higher ADPI ⇒ more of the room is within comfort;
    lower ADPI ⇒ consider diffuser count/spacing/throw, supply ΔT, or return layout.
  </div>
  <div style="margin-top:6px">
    <a href="https://www.priceindustries.com/content/uploads/assets/literature/engineering-guides/air-distribution-engineering-guide.pdf" target="_blank" rel="noopener">EDT/ADPI background (Price Industries Guide)</a> ·
    <a href="https://www.ashrae.org/file%20library/technical%20resources/ashrae%20journal/2021journaldocuments/july2021_22-23_ieq_burley.pdf" target="_blank" rel="noopener">ASHRAE Journal overview</a> ·
    <a href="https://www.simscale.com/forum/t/tutorial-thermal-comfort-parameters-for-hvac-simulations/49750" target="_blank" rel="noopener">Worked example of EDT/ADPI</a>
  </div>
</div>

  </header>

  <main>
    <section class="card">
      <h2>Inputs</h2>
      <form id="predict-form">
        <div class="grid">
          <label>Length (m)<input type="number" step="0.01" id="length_m" value="9.1"/></label>
          <label>Width (m)<input type="number" step="0.01" id="width_m" value="7.6"/></label>
          <label>Height (m)<input type="number" step="0.01" id="height_m" value="2.7"/></label>
          <label>DeltaT (°C, supply - room)<input type="number" step="0.1" id="deltaT_C" value="-8"/></label>
          <label>Total Supply (cfm)<input type="number" step="1" id="supply_total_cfm" value="1200"/></label>
          <label>Students<input type="number" id="students" value="28"/></label>
          <label>Teachers<input type="number" id="teachers" value="1"/></label>
          <label>Diffusers (count)<input type="number" id="diffuser_count" value="4"/></label>
          <label>Diffuser model<select id="model_id">
            <option value="example_square_cone">example_square_cone</option>
            <option value="example_4way_plaque">example_4way_plaque</option>
          </select></label>
          <label>Grid spacing (m)<input type="number" step="0.01" id="grid_spacing_m" value="0.1"/></label>
        </div>

        <h3>Manual placement (optional)</h3>
        <label><input type="checkbox" id="use_manual"/> Use my diffuser coordinates (disable auto-layout)</label>
        <div class="grid">
          <label>Diffuser coordinates (JSON array of {x,y})
            <textarea id="diffuser_coords" rows="3">[{"x":3.0,"y":2.5},{"x":3.0,"y":5.1},{"x":6.1,"y":2.5},{"x":6.1,"y":5.1}]</textarea>
          </label>
          <label>Return coordinates (JSON array of {x,y})
            <textarea id="return_coords" rows="3">[{"x":4.55,"y":3.80}]</textarea>
          </label>
        </div>

        <h3>Comfort tuning</h3>
        <div class="grid">
          <label>EDT min (°C)<input type="number" step="0.1" id="edt_min" value="-1.7"/></label>
          <label>EDT max (°C)<input type="number" step="0.1" id="edt_max" value="1.1"/></label>
          <label>Velocity cap V&lt; (m/s)<input type="number" step="0.01" id="v_cap" value="0.35"/></label>
          <label>Normalize to v95 (m/s, blank = disabled)<input type="number" step="0.01" id="v95_target" value="0.30"/></label>
          <label>Normalization blend (0..1)<input type="number" step="0.1" id="v95_blend" value="1.0"/></label>
        </div>

        <div class="actions">
          <button type="submit">Predict</button>
        </div>
      </form>
    </section>

    <section class="card" id="results" hidden>
      <h2>Results</h2>
      <div id="kpis" class="kpis"></div>
      <div class="images">
        <figure>
          <img id="img-vel" alt="Velocity heatmap" />
          <figcaption>Velocity magnitude @ occupied height</figcaption>
        </figure>
        <figure>
          <img id="img-edt" alt="EDT histogram" />
          <figcaption>EDT distribution</figcaption>
        </figure>
      </div>
      <div class="downloads">
        <a id="csv-link" href="#" download>Download coordinates CSV</a>
      </div>
      <details>
        <summary>Raw JSON</summary>
        <pre id="raw"></pre>
      </details>
    </section>
  </main>

  <script src="/static/app.js"></script>
</body>
</html>

